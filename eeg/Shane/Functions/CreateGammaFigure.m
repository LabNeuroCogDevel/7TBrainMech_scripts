
% Compute a time-frequency decomposition for every electrode
for elec = 1:EEG.nbchan
	[ersp,itc,powbase,times,freqs,erspboot,itcboot] = pop_newtimef(EEG,1, elec, [EEG.xmin EEG.xmax]*1000, [3 0.5], 'maxfreq', 50, 'padratio', 16, ... 
	'plotphase', 'off', 'timesout', 60, 'alpha', .05, 'plotersp','off', 'plotitc','off');

	if elec == 1  % create empty arrays if first electrode
		allersp = zeros([ size(ersp) EEG.nbchan]);
		allitc = zeros([ size(itc) EEG.nbchan]);
		allpowbase = zeros([ size(powbase) EEG.nbchan]);
		alltimes = zeros([ size(times) EEG.nbchan]);
		allfreqs = zeros([ size(freqs) EEG.nbchan]);
		allerspboot = zeros([ size(erspboot) EEG.nbchan]);
		allitcboot = zeros([ size(itcboot) EEG.nbchan]);
    end
	allersp (:,:,elec) = ersp;
	allitc (:,:,elec) = itc;
	allpowbase (:,:,elec) = powbase;
	alltimes (:,:,elec) = times;
	allfreqs (:,:,elec) = freqs;
	allerspboot (:,:,elec) = erspboot;
	allitcboot (:,:,elec) = itcboot;
end



% Plot a tftopo() figure summarizing all the time/frequency transforms
figure;
tftopo(allersp,alltimes(:,:,1),allfreqs(:,:,1),'mode','ave','limits', …
[nan nan nan 35 -1.5 1.5],'signifs', allerspboot, 'sigthresh', [6], 'timefreqs', ... 
[400 8; 350 14; 500 24; 1050 11], 'chanlocs', EEG.chanlocs);

